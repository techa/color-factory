<div class="hsv-picker">
  <Slider ref:hue value="{color.hue()}" max="359"/>
  <Spectrum ref:spectrum bind:color />
  <Slider ref:alpha value="{color.alpha() * 100}" />
</div>

<style>
  .hsv-picker {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: stretch;
    justify-content: space-around;
  }

  .hsv-picker > :nth-child(2) {
    margin: 0 8px;
    flex: 2 1 auto;
  }
  .hsv-picker > :first-child,
  .hsv-picker > :last-child {
  /* .hsv-picker > *:nth-child(2) {
  .hsv-picker > *:nth-child(2) { */
    flex: 0 1 30px;
  }

  .color-handle {
    position: absolute;
    width: 10px;
    height: 10px;
    margin: -5px;
    top: 0;
    left: 0;
    border: 1px solid black;
    border-radius: 5px;
    text-align: left;
    pointer-events: none;
  }
  .color-handle::before {
    content: '';
    position: absolute;
    width: 8px;
    height: 8px;
    top: 0;
    left: 0;
    border: 1px solid white;
    border-radius: 4px;
  }
</style>

<script>
  import Color from 'color'

  import Spectrum from './spectrum.html'
  import Slider from './slider.html'

  export default {
    components: {
      Spectrum,
      Slider,
    },
    data () {
      return {
        size: 150,
        strokeWidth: 10,
        color: Color('#000'),
      }
    },
    computed: {
      spectrumSize: ({ size, strokeWidth }) => ((size - strokeWidth * 2) / 1.4 | 0) - strokeWidth / 2,
      hsv: ({ color }) => color.hsv(),
      textColor: ({ color }) => color.isDark() ? '#fff' : '#000',
    },
    onstate ({ changed, current }) {
      if (changed.color) {
        const alphaColor = (alpha) => current.color.hsv().alpha(alpha).string()
        this.refs.alpha.draw(alphaColor(0), alphaColor(1))
      }
    },
    oncreate () {
      this.refs.hue.on('state', ({ changed, current, previous }) => {
        if (changed.value) {
          const {color} = this.get()
          this.set({color: color.hue(current.value)})
        }
      })
      this.refs.alpha.on('state', ({ changed, current, previous }) => {
        if (changed.value) {
          const {color} = this.get()
          this.set({color: color.alpha(current.value / 100)})
        }
      })
    },
  }
</script>
