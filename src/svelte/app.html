<div id="colors" ref="colors" style="color: {{textColor}};">
  <input type="text" placeholder="Name" style="color: {{textColor}};">
  <button>âž•</button>
  <button>BG</button>
  <ColorPicker />
  <hr>
  <ColorLists />
</div>

<div ref:box id="box" style="background-color: {{bgColor}};">
  {{#each cards as card, index}}
    <ColorCard :bgColor card={{card}} index={{index}} />
  {{/each}}
</div>

<ContextMenu />

<script>
  import ColorPicker from '../color-picker/color-picker.html'

  import ColorCard from './color-card.html'
  import ColorLists from './color-lists.html'
  import ContextMenu from './context-menu.html'

  import tinycolor from 'tinycolor2'
  import store from '../store'
  import {Selectable} from '../mouse'

  const COLOR_TYPE = ['hex', 'rgb', 'hsl']
  let colortypeindex = 0
  export default {
    components: {
      ColorPicker,
      ColorCard,
      ColorLists,
      ContextMenu
    },

    data () {
      return {
        color_type: 'hex',
        // colortypeindex: 0,
        colorcode: '',
        cards: [],
        bgColor: '#1f2532'
      }
    },
    computed: {
      textColor: bgColor => tinycolor.mostReadable(bgColor, ['#eee', '#111']),
      // color_type: (colorcode) => COLOR_TYPE[colortypeindex].toUpperCase()
    },
    oncreate () {
      console.log('this', this)
      this.selectable = new Selectable(this.refs.box, {
        filter: '.card',
        tolerance: 'fit',
        start: (e, position) => {
          store.trigger('menu_close')
        },
        selected: (position, indexs, els) => {
          store.trigger('cards.SELECT_CARDS', indexs, true)
        },
      })
    },

    methods: {
      color_typeChange () {
        ++colortypeindex
        colortypeindex %= COLOR_TYPE.length
        this.set({color_type: COLOR_TYPE[colortypeindex].toUpperCase()})
      },
      addCard () {
        const validationRegExp = /^(#?[a-f\d]{3}(?:[a-f\d]{3})?)(?:\s*\W?\s(.+))?/i
        const text = validationRegExp.exec(this.get('colorcode'))
        if (text) {
          store.trigger('cards.ADD_CARD', {
            name: '',
            color: text[1],
          })
          this.set({colorcode: ''})
        }
      }
    }
  }
</script>

<style>
  .ui-selectable-helper {
    position: absolute;
    z-index: 100;
    border: 1px dotted black;
  }
  #colors {
    width: 320px;
    height: 100vh;
    position: absolute;
    margin:0;
    padding: 20px;
    top:0;
    left:0;
  }
  #box {
    width: 100%;
    height: 100%;
  }
  #form_add {
    margin: 10px 0;
    /*font-size: 16px;*/
    display: flex;
    flex-direction: row;}
    #color_type {
      text-align: center;
      width: 42px;
      height: 42px;
      border-width: 1px 0 1px 1px;
      border-style: solid;
      border-top-left-radius: 4px;
      border-bottom-left-radius: 4px;}
    #color_hex {
      flex: 1 1 auto; /* width: auto; */
      height: 42px;
      padding: 8px 5px;
      border-width: 1px 0 1px 1px;
      border-style: solid;}
    #add_btn {
      width: 42px;
      height: 42px;
      text-align: center;
      border-width: 1px;
      border-style: solid;
      border-top-right-radius: 4px;
      border-bottom-right-radius: 4px;}
</style>
